---
phase: 06.1-uat-gap-closure
plan: 03
type: execute
wave: 3
depends_on: ["06.1-02"]
files_modified:
  - .claude/skills/grounded-search/query.md
  - .claude/skills/grounded-search/prep-gsd.md
autonomous: true

must_haves:
  truths:
    - "/grounded-search:query saves search results to ./grounded-search-results/ directory"
    - "/grounded-search:prep-gsd checks and recommends GSD agent modifications"
    - "Query skill fails with clear message if no query argument provided"
    - "Prep-gsd skill is idempotent - safe to run multiple times"
  artifacts:
    - path: ".claude/skills/grounded-search/query.md"
      provides: "Query skill that saves search results to file"
      contains: "grounded-search-results"
    - path: ".claude/skills/grounded-search/prep-gsd.md"
      provides: "Prep-gsd skill for GSD integration setup"
      contains: "mcp__grounded-search__"
  key_links:
    - from: ".claude/skills/grounded-search/query.md"
      to: "mcp__grounded-search__grounded_search"
      via: "tool invocation in skill"
      pattern: "mcp__grounded-search__grounded_search"
---

<objective>
Create two Claude Code slash command skills for improved DX: /grounded-search:query (save results to files) and /grounded-search:prep-gsd (configure GSD agents).

Purpose: Users need quick ways to save search results for later reference and to configure GSD framework integration without manual file editing.

Output: Two skill files in .claude/skills/grounded-search/ directory.
</objective>

<execution_context>
@/home/skello/.claude/get-shit-done/workflows/execute-plan.md
@/home/skello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-uat-gap-closure/06.1-CONTEXT.md
@.planning/phases/06.1-uat-gap-closure/06.1-RESEARCH.md
@.planning/phases/06.1-uat-gap-closure/06.1-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /grounded-search:query skill</name>
  <files>.claude/skills/grounded-search/query.md</files>
  <action>
Create directory `.claude/skills/grounded-search/` if it doesn't exist.

Create `query.md` skill file with this content:

```markdown
---
name: grounded-search:query
description: Perform a grounded search and save results to a file
---

# Grounded Search Query

Perform a Google-grounded search and save the results to a markdown file for later reference.

## Usage

```
/grounded-search:query "your search terms here"
```

## Behavior

1. **Validate input**: Query argument is REQUIRED. If missing, respond:
   > Error: Query argument required. Usage: `/grounded-search:query "your search terms"`

2. **Execute search**: Call `mcp__grounded-search__grounded_search` tool with the query.

3. **Generate filename**:
   - Directory: `./grounded-search-results/`
   - Format: `YYYY-MM-DD-HH-MM-{slug}.md`
   - Slug generation: Take first 30 chars of query, lowercase, replace non-alphanumeric with hyphens, trim trailing hyphens
   - Example: "TypeScript 5.8 new features" â†’ `typescript-5-8-new-features`

4. **Create directory**: Create `./grounded-search-results/` if it doesn't exist.

5. **Write file**: Save the full search response (answer + sources + search queries + metadata) to the generated filename.

6. **Report success**: Show:
   - The filename created
   - Brief summary (first 100 chars of answer)
   - Number of sources found

## Example

Input:
```
/grounded-search:query "TypeScript 5.8 features"
```

Output:
```
Saved search results to: ./grounded-search-results/2026-02-05-14-30-typescript-5-8-features.md

Summary: TypeScript 5.8 introduces several new features including...
Sources: 5 citations saved
```

## Notes

- Results are saved with full formatting matching the tool output
- Files are timestamped to avoid conflicts
- Directory is created automatically on first use
```
  </action>
  <verify>File exists at `.claude/skills/grounded-search/query.md` with correct frontmatter</verify>
  <done>Query skill file created with proper structure and behavior instructions</done>
</task>

<task type="auto">
  <name>Task 2: Create /grounded-search:prep-gsd skill</name>
  <files>.claude/skills/grounded-search/prep-gsd.md</files>
  <action>
Create `prep-gsd.md` skill file in `.claude/skills/grounded-search/` with this content:

```markdown
---
name: grounded-search:prep-gsd
description: Check and configure GSD agents for grounded search integration
---

# Prepare GSD for Grounded Search

Check current GSD configuration and recommend changes to enable grounded search in research agents.

## Usage

```
/grounded-search:prep-gsd
```

## Behavior

This skill is idempotent - safe to run multiple times. It always checks current state first.

### Step 1: Check Current State

Check these items and report status:

1. **Project agents directory**: Does `.claude/agents/` exist at project level?
2. **Research agents present**: Are `gsd-phase-researcher.md` and `gsd-project-researcher.md` in project agents?
3. **Tool list configured**: Do project agents have `mcp__grounded-search__*` in their tools list?
4. **Preference instruction**: Do project agents have grounded_search preference in their body?
5. **MCP configuration**: Does `.mcp.json` have `grounded-search` server configured?

### Step 2: Present Checklist

Show a checklist of needed changes:

```
## GSD Integration Status

[ ] .claude/agents/ directory exists
[ ] gsd-phase-researcher.md in project (for override)
[ ] gsd-project-researcher.md in project (for override)
[ ] Tool list includes mcp__grounded-search__*
[ ] Preference instruction added to agent body
[ ] .mcp.json has grounded-search configured

### Recommended Changes

1. Create .claude/agents/ directory
2. Copy gsd-phase-researcher.md from ~/.claude/agents/
3. Add mcp__grounded-search__* to tool list
...
```

### Step 3: Wait for Confirmation

Ask: "Apply these changes? (yes/no)"

Do NOT proceed without explicit "yes" confirmation.

### Step 4: Apply Changes

For confirmed items:

1. **Create directory**: `mkdir -p .claude/agents/`

2. **Copy agents**: If source agents exist at `~/.claude/agents/`:
   - Copy `gsd-phase-researcher.md` to `.claude/agents/`
   - Copy `gsd-project-researcher.md` to `.claude/agents/`

   If source agents don't exist, report: "Source agents not found at ~/.claude/agents/. Please ensure GSD is installed."

3. **Modify tool lists**: In each copied agent's frontmatter, add to tools line:
   ```yaml
   tools: Read, Write, Bash, Grep, Glob, WebSearch, WebFetch, mcp__context7__*, mcp__grounded-search__*
   ```

4. **Add preference instruction**: Append to each agent's body (after existing content):
   ```markdown

   ## Web Research Tool Preference

   For web research tasks, prefer `mcp__grounded-search__grounded_search` over `WebSearch`:
   - Better search quality via Google's grounded index
   - Query transparency shows actual searches performed
   - Fall back to WebSearch if grounded_search is unavailable or fails
   ```

5. **Check .mcp.json**: If grounded-search is not configured, offer to add it.
   Do NOT modify .mcp.json without asking - it may have project-specific settings.

### Step 5: Ask About Commit

After applying changes, ask: "Commit these changes? (yes/no)"

If yes, commit with message: "chore: configure GSD agents for grounded-search integration"

## Notes

- Project-level agents override user-level agents with the same name
- Only research agents are modified (gsd-phase-researcher, gsd-project-researcher)
- Original GSD agents at ~/.claude/agents/ are never modified
- Re-running this skill after GSD updates will show if agents need re-configuration
```
  </action>
  <verify>File exists at `.claude/skills/grounded-search/prep-gsd.md` with correct frontmatter</verify>
  <done>Prep-gsd skill file created with proper structure and idempotent behavior</done>
</task>

</tasks>

<verification>
1. Directory `.claude/skills/grounded-search/` exists
2. `query.md` has correct frontmatter (name, description)
3. `prep-gsd.md` has correct frontmatter (name, description)
4. Both skills reference correct tool name: `mcp__grounded-search__grounded_search`
5. Query skill specifies `./grounded-search-results/` output directory
6. Prep-gsd skill includes idempotent check-first behavior
</verification>

<success_criteria>
- /grounded-search:query skill saves search results to ./grounded-search-results/
- /grounded-search:prep-gsd skill checks and configures GSD agents
- Both skills have valid Claude Code skill frontmatter
- Skills use correct tool naming (mcp__grounded-search__*)
- Prep-gsd is idempotent and waits for confirmation
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-uat-gap-closure/06.1-03-SUMMARY.md`
</output>
