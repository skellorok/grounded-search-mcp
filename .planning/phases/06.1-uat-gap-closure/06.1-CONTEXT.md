# Phase 6.1: UAT Gap Closure & DX Tooling - Context

**Gathered:** 2026-02-05
**Status:** Ready for planning

<domain>
## Phase Boundary

Address all UAT gaps discovered in Phase 6: code fixes for fallback behavior, project rename from gemini-search-mcp to grounded-search-mcp, two new slash commands (/grounded-search:prep-gsd and /grounded-search:query), and documentation updates. This phase delivers production-ready DX tooling and completes the rename across all artifacts.

</domain>

<decisions>
## Implementation Decisions

### Slash Command: /grounded-search:query
- **Output location:** Save to `./grounded-search-results/` in working directory (specific name avoids conflicts with generic paths like ./research/)
- **Filename format:** Timestamp + slug: `YYYY-MM-DD-HH-MM-shortened-query.md` (sortable, avoids collisions, not full query text)
- **Query input:** Argument required - `/grounded-search:query "search terms"` - fails if no query provided
- **File content:** Full response matching tool output (answer + sources + search queries used + provider metadata)

### Slash Command: /grounded-search:prep-gsd
- **Mode:** Check + recommend with user confirmation
  - Analyze current state on each run (idempotent)
  - Check: modified agents exist? modifications correct? PROJECT.md instructions? CONTEXT.md instructions? .mcp.json configured?
  - Present checklist of recommended changes
  - User confirms before any modifications
- **File creation:**
  - For GSD-created markdown files (PROJECT.md, CONTEXT.md): modify only, don't create
  - For project agents: create from clean GSD global copies if missing (to enable override)
  - For .mcp.json: offer to add grounded-search entry if missing
- **Output format:** Checklist format showing each change needed
- **Agent scope:** Research agents only (gsd-phase-researcher, gsd-project-researcher)
- **Commit behavior:** Ask each time after applying changes whether to commit
- **Override behavior:**
  - Verify during development that project agents override global agents
  - If override works: use `.claude/agents/` (standard Claude Code location, simpler)
  - If override doesn't work: offer three options:
    1. Modify global agents (warn: applies to all projects, reverted on GSD update)
    2. Output manual instructions
    3. Cancel

### Error Fallback Strategy
- **Trigger errors:** Any non-2xx HTTP response triggers fallback attempt
- **Network errors:** Retry same provider once, then try fallback
- **Fallback reason:** Exposed in response metadata only (not warning at top)
- **Detail level:** Code + short message, e.g., "Fallback: 429 (rate limited)"
- **Both providers fail:** Show both errors, then fall back to Claude's built-in WebSearch
- **WebSearch fallback:**
  - Auto-fallback if both grounded providers fail
  - Warning at top + metadata details when WebSearch used
  - Pass through WebSearch response as-is (native format), just add fallback notice
- **Logging:** Debug log only (stderr when DEBUG=true or similar)

### Project Rename Scope
- **Physical folder:** Claude's discretion based on git history implications
- **npm package name:** `grounded-search-mcp`
- **MCP server key:** `grounded-search` (short, clean)
- **Tool names:** Claude's discretion (simple names likely sufficient given MCP prefix)
- **GitHub repo:** Yes, rename to grounded-search-mcp
- **Config/token storage path:** Rename to `~/.config/grounded-search-mcp/`
- **Old config path handling:** Claude's discretion (migration warning vs ignore)

### GSD Integration Documentation
- **Instruction placement:** Check GSD's actual structure, place as rule to prefer over WebSearch with WebSearch fallback
- **Doc scope:** Comprehensive - agents, prompts, skills, and manual tool invocation
- **Doc structure:** Both - brief in README + detailed docs/gsd-integration.md guide
- **Quick start:** Prominent TL;DR at top for GSD users: "GSD user? Run /grounded-search:prep-gsd"

### Claude's Discretion
- Physical folder rename decision
- Tool naming (simple vs descriptive)
- Old config path migration approach
- Project agent storage location (pending override verification)

</decisions>

<specifics>
## Specific Ideas

- prep-gsd should be idempotent - safe to run multiple times, always checks current state
- When project agent override doesn't work, the global agent modification warning should be explicit about GSD updates reverting changes
- WebSearch fallback maintains native format - don't try to force our metadata structure onto it
- Checklist format mirrors GSD's task presentation style

</specifics>

<deferred>
## Deferred Ideas

- Auto-migration of tokens from old config path to new path (decided to let user re-auth instead)
- Automatic re-run of prep-gsd after GSD updates (complex, user can do manually)

</deferred>

---

## Research Questions (for planning phase)

1. **Agent override verification:** Does `.claude/agents/` at project level override `~/.claude/get-shit-done/agents/`? Test before implementing prep-gsd.
2. **GSD instruction placement:** Where in PROJECT.md and CONTEXT.md structure should grounded_search instructions go? Analyze GSD templates.

---

*Phase: 06.1-uat-gap-closure*
*Context gathered: 2026-02-05*
