---
status: diagnosed
phase: 06.1-uat-gap-closure
source: 06.1-01-SUMMARY.md, 06.1-02-SUMMARY.md, 06.1-03-SUMMARY.md, 06.1-04-SUMMARY.md
started: 2026-02-05T10:15:00Z
updated: 2026-02-06T12:00:00Z
---

## Current Test

number: 10
name: Source URLs are actual destinations (re-verify)
expected: |
  Run a grounded_search query. Source citations should show actual destination URLs
  (e.g., accuweather.com, wikipedia.org) NOT Google redirect URLs
  (vertexaisearch.cloud.google.com/grounding-api-redirect/...)
awaiting: user response
note: PAUSED - Investigating why Antigravity returns no groundingMetadata. See .planning/debug/antigravity-grounding-investigation.md

## Tests

### 1. Fallback reason displayed in response
expected: When a search fails on primary provider and falls back to secondary, the response shows a specific reason (e.g., "429 (rate limited)", "503 (service unavailable)") instead of just "Fallback provider used"
result: pass

### 2. Non-auth errors trigger fallback
expected: If primary provider returns 404, 500, timeout, or other non-auth error, the search automatically tries the secondary provider instead of just failing
result: pass

### 3. WebSearch suggestion on complete failure
expected: When both providers fail, the response includes a suggestion to try WebSearch as an alternative
result: skipped
reason: Hard to simulate both authenticated providers failing simultaneously

### 4. Package renamed to grounded-search-mcp
expected: Running `npm pkg get name` in the project shows "grounded-search-mcp", and the bin command is also "grounded-search-mcp"
result: pass

### 5. Token storage uses new path
expected: After authenticating, tokens are stored at ~/.config/grounded-search-mcp/ (not google-search-mcp or gemini-search-mcp)
result: pass

### 6. /grounded-search:query skill works
expected: Running /grounded-search:query with a search query saves results to a timestamped markdown file in ./grounded-search-results/ directory
result: pass

### 7. /grounded-search:prep-gsd skill works
expected: Running /grounded-search:prep-gsd checks current GSD configuration and proposes agent override changes if grounded_search tool isn't configured
result: pass

### 8. README uses grounded-search-mcp naming
expected: README.md references "grounded-search-mcp" throughout (title, config examples, installation commands) with no "gemini-search-mcp" references
result: pass

### 9. GSD integration guide documents agent override
expected: docs/gsd-integration.md explains the agent override priority (CLI flag > project > user > plugin) and which agents benefit from grounded_search
result: pass
note: Re-verified after 06.1-06 fix - now contains both automated command AND manual instructions

### 10. Source URLs are actual destinations (not redirects)
expected: Source citations show actual destination URLs (e.g., accuweather.com, weather.gov) not Google redirect URLs (vertexaisearch.cloud.google.com/grounding-api-redirect/...)
result: issue
reported: "Sources show redirect URLs (vertexaisearch.cloud.google.com/grounding-api-redirect/...) instead of actual destination URLs. This breaks WebFetch follow-up which is critical for GSD research agents - they need to fetch content from sources Claude deems important. Potentially makes project unusable for GSD integration."
severity: blocker

## Summary

total: 10
passed: 7
issues: 2
pending: 0
skipped: 1

## Gaps

- truth: "GSD integration guide should have both automated command AND manual instructions"
  status: failed
  reason: "User reported: shouldn't have replaced the old documentation, should have added the automated method with the command but kept the manual instructions as well"
  severity: major
  test: 9
  root_cause: "Commit 0bfb58e replaced original guide content, removing manual setup details including Prerequisites, The Challenge explanation, Alternative Wildcard access, Project-Level Configuration, Maintenance Considerations, and Complete Override Example"
  artifacts:
    - path: "docs/gsd-integration.md"
      issue: "Missing sections from original guide"
  missing:
    - "Merge improved override mechanism with detailed manual instructions from original"
    - "Restore Prerequisites, Maintenance Considerations, Complete Example sections"
  debug_session: ".planning/debug/gsd-integration-missing-manual.md"

- truth: "Source URLs should be actual destinations, not Google redirect URLs"
  status: failed
  reason: "User reported: Sources show redirect URLs (vertexaisearch.cloud.google.com/grounding-api-redirect/...) instead of actual destination URLs. This breaks WebFetch follow-up which is critical for GSD research agents. Potentially makes project unusable for GSD integration."
  severity: blocker
  test: 10
  root_cause: "API LIMITATION - Gemini API intentionally returns redirect URLs. Actual URLs not available in response. Workaround: HTTP HEAD request to resolve redirects."
  artifacts:
    - path: "src/api/response.ts"
      issue: "Current implementation correct - API doesn't provide actual URLs"
  missing:
    - "Add URL resolution layer with HTTP HEAD requests"
    - "Follow redirects to get final URL"
    - "Consider caching resolved URLs for performance"
  debug_session: ".planning/debug/source-urls-google-redirect.md"
