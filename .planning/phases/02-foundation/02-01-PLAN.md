---
phase: 02-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - biome.json
  - vitest.config.ts
  - .husky/pre-commit
  - src/index.ts
  - src/tools/index.ts
  - src/tools/search.ts
  - src/tools/auth.ts
  - src/types/index.ts
  - src/auth/index.ts
  - src/api/index.ts
autonomous: true

must_haves:
  truths:
    - "MCP server runs without crashing when started via `npm start`"
    - "grounded_search tool appears in Claude Code tool list after registration"
    - "grounded_search tool returns mock JSON response when invoked with query"
    - "auth tool appears in tool list and returns mock not-implemented response"
    - "Pre-commit hook runs lint and typecheck on staged files"
  artifacts:
    - path: "package.json"
      provides: "Project configuration with MCP SDK, Zod, dev dependencies"
      contains: "@modelcontextprotocol/sdk"
    - path: "tsconfig.json"
      provides: "TypeScript configuration with Node16 module resolution"
      contains: "Node16"
    - path: "biome.json"
      provides: "Linting and formatting configuration"
      contains: "recommended"
    - path: "src/index.ts"
      provides: "MCP server entry point with stdio transport"
      exports: []
    - path: "src/tools/search.ts"
      provides: "grounded_search tool definition with Zod schema"
      contains: "grounded_search"
    - path: "src/tools/auth.ts"
      provides: "auth tool definition with provider parameter"
      contains: "auth"
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook running typecheck and lint-staged"
      contains: "typecheck"
  key_links:
    - from: "src/index.ts"
      to: "src/tools/index.ts"
      via: "registerTools function import"
      pattern: "import.*registerTools.*from.*tools"
    - from: "src/tools/index.ts"
      to: "src/tools/search.ts"
      via: "search tool registration"
      pattern: "import.*from.*search"
    - from: "src/tools/index.ts"
      to: "src/tools/auth.ts"
      via: "auth tool registration"
      pattern: "import.*from.*auth"
---

<objective>
Establish a complete MCP server skeleton with placeholder tools that runs, registers with Claude Code, and returns mock responses.

Purpose: Create the foundation for all subsequent phases - authentication, core search, and configuration all build on this working server.
Output: Running MCP server with `grounded_search` and `auth` tools returning mock responses, complete dev toolchain.
</objective>

<execution_context>
@/home/skello/.claude/get-shit-done/workflows/execute-plan.md
@/home/skello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation/02-CONTEXT.md
@.planning/phases/02-foundation/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project scaffold</name>
  <files>
    package.json
    tsconfig.json
    biome.json
    vitest.config.ts
    .husky/pre-commit
    src/types/index.ts
    src/auth/index.ts
    src/api/index.ts
  </files>
  <action>
Create the project foundation using configurations from RESEARCH.md:

1. Create `package.json` with:
   - name: `gemini-search-mcp`
   - version: `0.1.0`
   - type: `module`
   - bin pointing to `./build/index.js`
   - scripts: dev, build, start, test, lint, lint:fix, format, typecheck, prepare, inspector
   - lint-staged configuration inline
   - engines: node >= 18
   - Dependencies: @modelcontextprotocol/sdk, zod
   - DevDependencies: typescript, @types/node, tsx, vitest, @biomejs/biome, husky, lint-staged

2. Create `tsconfig.json` with:
   - target: ES2022
   - module: Node16
   - moduleResolution: Node16
   - strict: true
   - outDir: ./build
   - rootDir: ./src

3. Create `biome.json` with recommended rules, tab indent, single quotes, semicolons

4. Create `vitest.config.ts` with node environment, globals true, include src/**/*.test.ts

5. Initialize Husky and create `.husky/pre-commit` hook that runs:
   - `npm run typecheck`
   - `npx lint-staged`

6. Create placeholder files with exports for later phases:
   - `src/types/index.ts` - Export mock response types (SearchResponse, AuthResponse)
   - `src/auth/index.ts` - Export placeholder `getTokens()` returning null
   - `src/api/index.ts` - Export placeholder `search()` returning mock response

Run `npm install` after creating package.json.
Initialize Husky with `npx husky init` after npm install.
  </action>
  <verify>
    npm install succeeds without errors
    npm run typecheck succeeds (even with placeholder files)
    npm run lint succeeds
    .husky/pre-commit file exists with correct content
  </verify>
  <done>
    Project scaffold complete: package.json, tsconfig.json, biome.json, vitest.config.ts exist
    All dependencies installed
    TypeScript compiles without errors
    Husky pre-commit hook configured
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement MCP server with placeholder tools</name>
  <files>
    src/index.ts
    src/tools/index.ts
    src/tools/search.ts
    src/tools/auth.ts
  </files>
  <action>
Implement the MCP server following patterns from RESEARCH.md:

1. Create `src/tools/search.ts`:
   - Export `registerSearchTool(server: McpServer)` function
   - Tool name: `grounded_search`
   - Input schema using Zod:
     - query: z.string().min(1).max(1000).describe('Search query')
     - model: z.string().optional().default('gemini-3-flash').describe('Gemini model')
     - thinking_level: z.enum(['none', 'low', 'medium', 'high']).optional().default('medium').describe('Thinking depth')
   - Return mock response matching SearchResponse type:
     ```json
     {
       "answer": "[MOCK] Search results for: \"${query}\"",
       "model": "${model}",
       "thinking_level": "${thinking_level}",
       "sources": [{ "title": "Example Source", "url": "https://example.com" }],
       "searchQueries": ["${query}"]
     }
     ```

2. Create `src/tools/auth.ts`:
   - Export `registerAuthTool(server: McpServer)` function
   - Tool name: `auth`
   - Input schema using Zod:
     - provider: z.enum(['gemini-cli', 'antigravity']).optional().default('gemini-cli').describe('Auth provider')
   - Return mock error response:
     - content: `[MOCK] Auth with ${provider} not yet implemented`
     - isError: true

3. Create `src/tools/index.ts`:
   - Export `registerTools(server: McpServer)` function
   - Import and call registerSearchTool and registerAuthTool

4. Create `src/index.ts`:
   - Import McpServer from @modelcontextprotocol/sdk/server/mcp.js
   - Import StdioServerTransport from @modelcontextprotocol/sdk/server/stdio.js
   - Create server with name: 'gemini-search-mcp', version: '1.0.0'
   - Call registerTools(server)
   - Create StdioServerTransport
   - Connect server to transport
   - Use console.error for startup message (CRITICAL: no console.log)
   - Add shebang line for bin execution: #!/usr/bin/env node

CRITICAL: All imports from local files must use .js extension (e.g., `import { registerTools } from './tools/index.js'`)
CRITICAL: All logging must use console.error() - stdout is reserved for JSON-RPC
  </action>
  <verify>
    npm run build succeeds
    npm start runs without crashing (Ctrl+C to exit)
    No console.log statements in any src/*.ts files
    All local imports use .js extension
  </verify>
  <done>
    MCP server starts successfully via npm start
    Server outputs startup message to stderr
    No stdout corruption (JSON-RPC stream clean)
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify MCP integration with Claude Code</name>
  <files>
    .mcp.json
  </files>
  <action>
Create project-scope MCP registration and verify tools appear in Claude Code:

1. Run `npm run build` to ensure build/index.js exists

2. Create `.mcp.json` in project root with:
   ```json
   {
     "mcpServers": {
       "gemini-search": {
         "command": "node",
         "args": ["build/index.js"]
       }
     }
   }
   ```

3. Verify integration by running the MCP Inspector:
   ```bash
   npx @modelcontextprotocol/inspector node build/index.js
   ```

   In Inspector (opens browser at localhost:6274):
   - Click "Tools" tab
   - Verify `grounded_search` and `auth` tools appear
   - Test `grounded_search` with query "test query"
   - Verify mock response is returned

4. Document registration options in a comment at top of .mcp.json:
   - Project scope: .mcp.json (current approach)
   - User scope: ~/.claude.json with absolute path

If MCP Inspector fails to start, fall back to manual verification:
   - Check build/index.js has shebang and is executable
   - Run `node build/index.js` and verify it starts without crashing
   - Check no stdout output except JSON-RPC (stderr only for logs)
  </action>
  <verify>
    .mcp.json exists with correct configuration
    build/index.js exists and has correct shebang
    MCP Inspector shows both tools OR manual verification passes
  </verify>
  <done>
    MCP registration file created at .mcp.json
    Tools verified via Inspector or manual check
    Server follows MCP protocol (JSON-RPC compliant)
    Phase 2 success criteria met: server runs, tools appear, mock responses work
  </done>
</task>

</tasks>

<verification>
Run these commands to verify phase completion:

```bash
# Build passes
npm run build

# TypeScript passes
npm run typecheck

# Lint passes
npm run lint

# Server starts (will hang waiting for input - Ctrl+C to exit)
npm start

# Verify build output
ls -la build/index.js

# Verify shebang
head -1 build/index.js

# Test with MCP Inspector (opens browser)
npx @modelcontextprotocol/inspector node build/index.js
```

In MCP Inspector:
1. Tools tab shows `grounded_search` and `auth`
2. Call `grounded_search` with `{"query": "test"}` - returns mock JSON
3. Call `auth` with `{}` - returns mock error about not implemented
</verification>

<success_criteria>
1. `npm run build` succeeds without errors
2. `npm run typecheck` succeeds without errors
3. `npm run lint` succeeds without errors
4. `npm start` runs server that waits for input (no crash)
5. MCP Inspector shows `grounded_search` and `auth` tools
6. `grounded_search` tool returns mock response with query, model, thinking_level, sources, searchQueries
7. `auth` tool returns mock error response
8. Pre-commit hook configured (.husky/pre-commit exists)
9. All success criteria from ROADMAP.md Phase 2 met
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation/02-01-SUMMARY.md` following the summary template.

Include in summary:
- All files created
- npm package versions installed
- Verification results from MCP Inspector
- Any deviations from plan
- Ready confirmation for Phase 3 (Authentication)
</output>
