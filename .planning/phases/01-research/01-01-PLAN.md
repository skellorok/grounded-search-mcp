---
phase: 01-research
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/01-research/01-01-SUMMARY.md
autonomous: false

must_haves:
  truths:
    - "AUTH-01 viability is documented with source code evidence"
    - "SEARCH-03 viability is documented with source code evidence"
    - "OpenCode code reuse strategy is documented with specific files identified"
    - "GSD integration approach is documented with concrete steps"
  artifacts:
    - path: ".planning/phases/01-research/01-01-SUMMARY.md"
      provides: "Research investigation findings with decisions"
      contains: "AUTH-01"
  key_links:
    - from: "01-01-SUMMARY.md"
      to: ".planning/ROADMAP.md"
      via: "Findings determine AUTH-01/SEARCH-03 conditional scope"
      pattern: "(AUTH-01|SEARCH-03).*(viable|descope)"
---

<objective>
Validate four technical assumptions through source code analysis and document findings that inform downstream implementation decisions.

Purpose: Phase 1 exists to de-risk implementation. Research findings determine whether AUTH-01 (Gemini CLI auth) and SEARCH-03 (query transparency) remain in scope, inform code reuse strategy from OpenCode, and clarify GSD integration approach. Shipping code in later phases without this validation risks building on incorrect assumptions.

Output: Updated SUMMARY.md with validated research findings, concrete decisions on requirement viability, and documented code reuse strategy.
</objective>

<execution_context>
@/home/skello/.claude/get-shit-done/workflows/execute-plan.md
@/home/skello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-research/01-CONTEXT.md
@.planning/phases/01-research/01-RESEARCH.md
@custom_research/2026-02-03-antigravity-api-mcp-integration-deep-dive.md
@custom_research/2026-02-03-oauth-auth-research.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate RESEARCH-01 findings via source code</name>
  <files>
    ~/.nvm/versions/node/v20.20.0/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/config/defaultModelConfigs.js
    ~/.nvm/versions/node/v20.20.0/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/tools/web-search.js
    ~/.cache/opencode/node_modules/opencode-antigravity-auth/dist/src/plugin/search.js
  </files>
  <action>
    Validate three RESEARCH-01 claims from 01-RESEARCH.md against actual source code:

    1. **Gemini CLI grounded search support:**
       - Read `defaultModelConfigs.js` and locate the `web-search` model alias
       - Confirm it includes `tools: [{ googleSearch: {} }]` configuration
       - Document exact line numbers as evidence

    2. **API endpoint comparison:**
       - Find endpoint configuration in both Gemini CLI and OpenCode sources
       - Confirm both use `cloudcode-pa.googleapis.com` (or variants)
       - Note any differences in sandbox vs production endpoints

    3. **Query transparency (webSearchQueries):**
       - Read `web-search.js` in Gemini CLI for `groundingMetadata` parsing
       - Read `search.js` in OpenCode for `webSearchQueries` extraction
       - Cross-reference with `custom_research/2026-02-03-antigravity-api-mcp-integration-deep-dive.md`

    Record findings with specific file paths, line numbers, and code snippets.

    **Decision criteria:**
    - If Gemini CLI has googleSearch tool: AUTH-01 remains viable
    - If API returns webSearchQueries: SEARCH-03 remains viable
  </action>
  <verify>
    - File paths exist and are readable
    - Line number references match actual content
    - Findings explicitly state AUTH-01 and SEARCH-03 viability
  </verify>
  <done>
    RESEARCH-01 validated with source code evidence. Clear decision documented for AUTH-01 viability (yes/no) and SEARCH-03 viability (yes/no).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>RESEARCH-01 findings validated against source code</what-built>
  <how-to-verify>
    Review the source code findings:
    1. Does evidence support AUTH-01 viability decision?
    2. Does evidence support SEARCH-03 viability decision?
    3. Are there any concerns about the findings?
  </how-to-verify>
  <resume-signal>Type "approved" to continue or describe concerns</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Validate RESEARCH-02 code reuse strategy</name>
  <files>
    ~/.cache/opencode/node_modules/opencode-antigravity-auth/dist/src/constants.js
    ~/.cache/opencode/node_modules/opencode-antigravity-auth/dist/src/plugin/search.js
    ~/.cache/opencode/node_modules/opencode-antigravity-auth/dist/src/antigravity/oauth.js
    ~/.cache/opencode/node_modules/opencode-antigravity-auth/dist/src/plugin/token.js
  </files>
  <action>
    Evaluate OpenCode antigravity-auth plugin for code reuse potential:

    1. **constants.js analysis:**
       - Identify: endpoints, headers, version strings, OAuth credentials, system instructions
       - Note which can be directly copied vs need adaptation
       - Document ANTIGRAVITY_VERSION value (expected: 1.15.8)

    2. **search.js analysis (two-stage orchestration):**
       - Document the two-stage pattern structure
       - Identify response parsing for `groundingMetadata`
       - Note how `webSearchQueries` is extracted

    3. **oauth.js analysis:**
       - Document PKCE flow implementation
       - Note loopback server port handling (51121, 36742)
       - Identify what needs MCP adaptation (IPC vs direct)

    4. **token.js analysis:**
       - Document token refresh logic
       - Note storage locations referenced

    **Reuse classification:**
    - HIGH: Can copy directly with minimal changes
    - MEDIUM: Pattern/approach reusable, code needs adaptation
    - LOW: Reference only, will reimplement

    Document specific functions/patterns to reuse.
  </action>
  <verify>
    - All four files analyzed with specific findings
    - Each file has reuse classification (HIGH/MEDIUM/LOW)
    - Two-stage orchestration pattern documented with enough detail to replicate
  </verify>
  <done>
    Code reuse strategy documented with specific files, functions, and reuse classifications. Clear guidance for Phase 2-4 implementation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>RESEARCH-02 code reuse evaluation completed</what-built>
  <how-to-verify>
    Review the code reuse findings:
    1. Is the two-stage orchestration pattern clear enough to implement?
    2. Is the reuse strategy practical?
    3. Any concerns about the approach?
  </how-to-verify>
  <resume-signal>Type "approved" to continue or describe concerns</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Validate RESEARCH-03/04 GSD integration approach</name>
  <files>
    ~/.claude/agents/gsd-phase-researcher.md
    ~/.claude/agents/gsd-project-researcher.md
  </files>
  <action>
    Investigate GSD agent tool integration:

    1. **Agent tool declaration pattern:**
       - Read both researcher agent files
       - Document exact YAML frontmatter structure
       - Confirm `tools:` field includes `WebSearch, WebFetch, mcp__context7__*`
       - Note how MCP tools are referenced (format: `mcp__server__tool`)

    2. **Tool replacement strategy:**
       - Determine if WebSearch can be replaced/supplemented with MCP tool
       - Document exact syntax: `mcp__google-grounded-search__grounded_search`
       - Check if tools field supports wildcards like `mcp__google-grounded-search__*`

    3. **Plugin bug (#13605) verification:**
       - Confirm agents are in `~/.claude/agents/` (global, not plugin)
       - Verify MCP tools already work (evidence: `mcp__context7__*` present)
       - Conclude: workaround not needed for current setup

    4. **Integration questions from CONTEXT.md:**
       - Can we inject tool preference at invocation time? Document answer.
       - How do agents modify behavior (prompts vs tool instructions)? Document.
       - Does tool produce RESEARCH.md or agent consumes output? Document.
       - What happens if CONTEXT.md exists when researcher runs? Document.

    **Output:** Clear integration approach with concrete steps.
  </action>
  <verify>
    - Both agent files read with frontmatter documented
    - All four CONTEXT.md questions answered
    - Integration approach documented with specific syntax
  </verify>
  <done>
    GSD integration approach documented. Plugin bug verified as non-issue. Clear guidance for adding MCP tool to agent tool lists.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>RESEARCH-03/04 GSD integration investigation completed</what-built>
  <how-to-verify>
    Review the GSD integration findings:
    1. Is the integration approach clear and actionable?
    2. Are all CONTEXT.md questions answered?
    3. Any concerns about the plugin bug or workaround?
  </how-to-verify>
  <resume-signal>Type "approved" to continue or describe concerns</resume-signal>
</task>

<task type="auto">
  <name>Task 4: Compile findings and create SUMMARY</name>
  <files>.planning/phases/01-research/01-01-SUMMARY.md</files>
  <action>
    Create comprehensive SUMMARY.md that documents all research findings:

    **Structure:**
    ```markdown
    ---
    phase: 01-research
    plan: 01
    subsystem: research
    affects: [02-foundation, 03-authentication, 04-core-search]
    tech-stack:
      analyzed: [gemini-cli, opencode-antigravity-auth, gsd-agents]
    decisions:
      - AUTH-01: [viable/descoped] - [rationale]
      - SEARCH-03: [viable/descoped] - [rationale]
    ---

    # Phase 01 Plan 01: Research Investigations - Summary

    ## What Was Done
    [Investigation activities]

    ## Key Findings

    ### RESEARCH-01: Gemini CLI vs Antigravity
    [Findings with evidence]

    ### RESEARCH-02: OpenCode Code Reuse
    [Findings with reuse strategy]

    ### RESEARCH-03/04: GSD Integration
    [Findings with integration approach]

    ## Decisions Made
    [Decisions with rationale]

    ## Impact on Downstream Phases
    [How findings affect Phase 2-6]
    ```

    Include:
    - All source code evidence (paths, line numbers, snippets)
    - Clear decisions on AUTH-01 and SEARCH-03 viability
    - Code reuse strategy with specific files to reference
    - GSD integration steps
  </action>
  <verify>
    - SUMMARY.md exists at correct path
    - Contains frontmatter with affects array
    - Contains all four RESEARCH requirement findings
    - Contains explicit AUTH-01 and SEARCH-03 decisions
  </verify>
  <done>
    SUMMARY.md created with complete research findings. All four research requirements documented with evidence. Downstream phases can reference this for implementation decisions.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **RESEARCH-01 validated:** AUTH-01 and SEARCH-03 viability documented with source code evidence
2. **RESEARCH-02 validated:** Code reuse strategy documented with HIGH/MEDIUM/LOW classifications
3. **RESEARCH-03/04 validated:** GSD integration approach documented with concrete syntax
4. **SUMMARY complete:** All findings compiled with frontmatter linking to downstream phases
</verification>

<success_criteria>
Plan succeeds when:
- All four RESEARCH requirements have validated findings
- AUTH-01 viability has explicit decision (viable or descoped)
- SEARCH-03 viability has explicit decision (viable or descoped)
- Code reuse strategy identifies specific files and patterns
- GSD integration has documented approach with syntax examples
- SUMMARY.md exists and contains all findings with evidence
</success_criteria>

<output>
After completion, create `.planning/phases/01-research/01-01-SUMMARY.md` following the summary template with frontmatter including `affects: [02-foundation, 03-authentication, 04-core-search]`.
</output>
